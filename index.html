<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Electoral - Impacto de Reformas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header verde -->
    <div class="header-section">
        <div class="header-content">
            <div class="header-title">Reforma Electoral</div>
            <div class="header-date">Fecha de corte: 18-08-2025</div>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="main-container">
            <div class="dashboard-title">
                <div class="title-header">
                    <div class="spacer"></div>
                    <h1 class="main-title">Impacto de reformas en la composición del Congreso</h1>
                    <div class="spacer"></div>
                </div>
                
                <div class="controls-section">
                    <!-- Tabs para Cámara -->
                    <div class="chamber-tabs">
                        <button class="tab-button active" data-group="chamber" data-value="diputados">Cámara de diputados</button>
                        <button class="tab-button" data-group="chamber" data-value="senado">Cámara de senadores</button>
                    </div>
                    
                    <!-- Controles de Año y Modelo -->
                    <div class="controls-row">
                        <div class="control-group">
                            <label class="control-label">Año</label>
                            <div class="control-pills">
                                <button class="pill-button active" data-group="year" data-value="2018">2018</button>
                                <button class="pill-button" data-group="year" data-value="2021">2021</button>
                                <button class="pill-button" data-group="year" data-value="2024">2024</button>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">Modelo</label>
                            <div class="control-pills">
                                <button class="pill-button active" data-group="model" data-value="vigente">Vigente</button>
                                <button class="pill-button" data-group="model" data-value="plan-a">Plan A</button>
                                <button class="pill-button" data-group="model" data-value="plan-c">Plan C</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="kpi-section">
                <h2 class="kpi-title">Indicadores clave</h2>
                <div class="kpi-cards-container">
                    <div class="kpi-card">
                        <div class="kpi-card-header">
                            <div class="kpi-card-title">Total de escaños</div>
                        </div>
                        <div class="kpi-value" id="total-seats">500</div>
                        <div class="kpi-change">0%</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-card-header">
                            <div class="kpi-card-title">Índice de Gallagher</div>
                            <div class="info-icon" id="gallagher-info-trigger" tabindex="0" style="cursor:pointer;">
                                <div class="dot"></div>
                                <div class="dot"></div>
                                <div class="dot"></div>
                            </div>
                        </div>
                        <div class="kpi-value" id="gallagher-index">5.0</div>
                        <div class="kpi-change">0%</div>
                    </div>
                    
                    <div class="kpi-card special-card">
                        <div class="kpi-card-header">
                            <div class="kpi-card-title-multi">
                                <span class="title-main">% votos vs. % escaños</span>
                                <span class="title-sub">(Δ promedio)</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="vote-seat-diff">2%</div>
                        <div class="kpi-change">-0.5%</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-card-header">
                            <div class="kpi-card-title">Total de votos</div>
                        </div>
                        <div class="kpi-value" id="total-votes">60 M</div>
                        <div class="kpi-change">5%</div>
                    </div>
                </div>
            </div>

            <div class="chart-section">
                <h2 class="chart-title">Composición de la Cámara de Diputados</h2>
                <div class="chart-content">
                    <div class="seat-map-section">
                        <div class="seat-map-container">
                            <div class="seat-grid" id="seat-grid">
                                <!-- Seats will be generated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="results-panel">
                            <h3 class="results-title">Resultados por partido</h3>
                            
                            <div class="party-result">
                                <div class="party-color" style="background: #8b2231;"></div>
                                <div class="party-name">MORENA</div>
                                <div class="party-info">
                                    <div class="party-seats">267 escaños</div>
                                    <div class="party-percentage">53.4%</div>
                                </div>
                            </div>
                            
                            <div class="party-result">
                                <div class="party-color" style="background: #0055a5;"></div>
                                <div class="party-name">PAN</div>
                                <div class="party-info">
                                    <div class="party-seats">106 escaños</div>
                                    <div class="party-percentage">21.2%</div>
                                </div>
                            </div>
                            
                            <div class="party-result">
                                <div class="party-color" style="background: #0D7137;"></div>
                                <div class="party-name">PRI</div>
                                <div class="party-info">
                                    <div class="party-seats">69 escaños</div>
                                    <div class="party-percentage">13.8%</div>
                                </div>
                            </div>
                            
                            <div class="party-result">
                                <div class="party-color" style="background: #d52b1e;"></div>
                                <div class="party-name">PT</div>
                                <div class="party-info">
                                    <div class="party-seats">38 escaños</div>
                                    <div class="party-percentage">7.6%</div>
                                </div>
                            </div>
                            
                            <div class="party-result">
                                <div class="party-color" style="background: #5CE23D;"></div>
                                <div class="party-name">PVEM</div>
                                <div class="party-info">
                                    <div class="party-seats">13 escaños</div>
                                    <div class="party-percentage">2.6%</div>
                                </div>
                            </div>
                            
                            <div class="party-result">
                                <div class="party-color" style="background: #f58025;"></div>
                                <div class="party-name">MC</div>
                                <div class="party-info">
                                    <div class="party-seats">5 escaños</div>
                                    <div class="party-percentage">1.0%</div>
                                </div>
                            </div>
                            
                            <div class="party-result">
                                <div class="party-color" style="background: #FFCC00;"></div>
                                <div class="party-name">PRD</div>
                                <div class="party-info">
                                    <div class="party-seats">2 escaños</div>
                                    <div class="party-percentage">0.4%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="scatter-plot-section">
                    <div class="scatter-plot-container">
                        <div class="scatter-header">
                            <h3 class="scatter-plot-title">Proporcionalidad Electoral: % Votos vs. % Escaños</h3>
                        </div>
                        <div class="scatter-plot-chart" id="scatter-chart">
                            <div class="chart-grid" id="chart-grid">
                                <!-- Grid lines will be generated by JavaScript -->
                            </div>
                            <div class="chart-axis axis-x"></div>
                            <div class="chart-axis axis-y"></div>
                            <div class="axis-label x-label">% de Votos</div>
                            <div class="axis-label y-label">% de Escaños</div>
                            <!-- Points will be generated by JavaScript -->
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: #8b2231;"></div>
                                <span class="legend-text">MORENA</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #0055a5;"></div>
                                <span class="legend-text">PAN</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #0D7137;"></div>
                                <span class="legend-text">PRI</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #d52b1e;"></div>
                                <span class="legend-text">PT</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #5CE23D;"></div>
                                <span class="legend-text">PVEM</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #f58025;"></div>
                                <span class="legend-text">MC</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #FFCC00;"></div>
                                <span class="legend-text">PRD</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip Gallagher -->
    <div id="gallagher-tooltip" style="display:none; position:absolute; z-index:1000;">
        <div style="position:relative; width: 340px; padding: 24px 24px 20px 24px; background: white; box-shadow: 0 4px 16px rgba(0,0,0,0.15); border-radius: 16px; display: flex; flex-direction: column; gap: 10px;">
            <div style="width: 100%;">
                <span style="color: #161A1D; font-size: 18px; font-family: 'Noto Sans', sans-serif; font-weight: 400; line-height: 24px; word-wrap: break-word;">El</span>
                <span style="color: #161A1D; font-size: 18px; font-family: 'Noto Sans', sans-serif; font-weight: 700; line-height: 24px; word-wrap: break-word;"> Índice de Gallagher</span>
                <span style="color: #161A1D; font-size: 18px; font-family: 'Noto Sans', sans-serif; font-weight: 400; line-height: 24px; word-wrap: break-word;"> mide qué tan proporcional es un sistema electoral, comparando la cantidad de votos que recibe cada partido con los escaños que finalmente obtiene. Un resultado cercano a 0 significa que la representación en el congreso refleja casi de manera exacta la proporción de votos; en cambio, un valor </span>
                <span style="color: #161A1D; font-size: 18px; font-family: 'Noto Sans', sans-serif; font-weight: 700; line-height: 24px; word-wrap: break-word;">más alto</span>
                <span style="color: #161A1D; font-size: 18px; font-family: 'Noto Sans', sans-serif; font-weight: 400; line-height: 24px; word-wrap: break-word;"> indica mayor desproporcionalidad, es decir, que algunos partidos terminan sobrerrepresentados y otros infrarrepresentados.</span>
            </div>
        </div>
    </div>

    <script>
        // Data for different scenarios
        const seatData = {
            2021: {
                vigente: {
                    diputados: {
                        MORENA: 267,
                        PAN: 106,
                        PRI: 69,
                        PT: 38,
                        PVEM: 13,
                        MC: 5,
                        PRD: 2
                    }
                }
            }
        };

        // Party data for scatter plot (votes vs seats percentage)
        const partyData = {
            2021: {
                vigente: {
                    diputados: [
                        { party: 'MORENA', votes: 41.8, seats: 53.4, color: '#8b2231' },
                        { party: 'PAN', votes: 28.2, seats: 21.2, color: '#0055a5' },
                        { party: 'PRI', votes: 16.5, seats: 13.8, color: '#0D7137' },
                        { party: 'PT', votes: 3.8, seats: 7.6, color: '#d52b1e' },
                        { party: 'PVEM', votes: 3.2, seats: 2.6, color: '#5CE23D' },
                        { party: 'MC', votes: 4.1, seats: 1.0, color: '#f58025' },
                        { party: 'PRD', votes: 2.4, seats: 0.4, color: '#FFCC00' }
                    ]
                }
            }
        };

        // Generate scatter plot
        function generateScatterPlot() {
            const chart = document.getElementById('scatter-chart');
            const grid = document.getElementById('chart-grid');

            // Clear existing points, grid, and diagonal line
            const existingPoints = chart.querySelectorAll('.scatter-point');
            const existingGrid = grid.querySelectorAll('.grid-line');
            const existingDiagonal = chart.querySelectorAll('.diagonal-line');
            existingPoints.forEach(point => point.remove());
            existingGrid.forEach(line => line.remove());
            existingDiagonal.forEach(line => line.remove());

            // Get current selections
            const year = document.querySelector('[data-group="year"].active')?.dataset.value || '2021';
            const model = document.querySelector('[data-group="model"].active')?.dataset.value || 'vigente';
            const chamber = document.querySelector('[data-group="chamber"].active')?.dataset.value || 'diputados';

            // Get party data
            const currentPartyData = partyData[year]?.[model]?.[chamber];
            if (!currentPartyData) return;

            // Data ranges (0-60% for better visualization)
            const maxPercent = 60;

            // Generate grid lines and axis labels
            for (let percent = 0; percent <= maxPercent; percent += 10) {
                const position = (percent / maxPercent) * 100;

                // Vertical grid lines
                const vGridLine = document.createElement('div');
                vGridLine.className = 'grid-line vertical';
                vGridLine.style.left = `${position}%`;
                grid.appendChild(vGridLine);

                // Horizontal grid lines
                const hGridLine = document.createElement('div');
                hGridLine.className = 'grid-line horizontal';
                hGridLine.style.top = `${100 - position}%`;
                grid.appendChild(hGridLine);

                // Add axis numbers
                if (percent > 0) {
                    // X-axis numbers
                    const xLabel = document.createElement('div');
                    xLabel.style.position = 'absolute';
                    xLabel.style.left = `calc(60px + ${position}% - 10px)`;
                    xLabel.style.bottom = '25px';
                    xLabel.style.fontSize = '10px';
                    xLabel.style.color = '#3b3f8d';
                    xLabel.textContent = `${percent}%`;
                    chart.appendChild(xLabel);

                    // Y-axis numbers
                    const yLabel = document.createElement('div');
                    yLabel.style.position = 'absolute';
                    yLabel.style.left = '35px';
                    yLabel.style.top = `calc(30px + ${100 - position}% - 8px)`;
                    yLabel.style.fontSize = '10px';
                    yLabel.style.color = '#3b3f8d';
                    yLabel.textContent = `${percent}%`;
                    chart.appendChild(yLabel);
                }
            }

            // Add diagonal line for perfect proportionality
            const diagonalLine = document.createElement('div');
            diagonalLine.className = 'diagonal-line';
            diagonalLine.style.position = 'absolute';
            diagonalLine.style.left = '60px';
            diagonalLine.style.top = '30px';
            diagonalLine.style.width = 'calc(100% - 90px)';
            diagonalLine.style.height = 'calc(100% - 80px)';
            diagonalLine.style.background = 'linear-gradient(135deg, transparent 49%, #3b3f8d 49%, #3b3f8d 51%, transparent 51%)';
            diagonalLine.style.opacity = '0.3';
            diagonalLine.style.pointerEvents = 'none';
            chart.appendChild(diagonalLine);

            // Generate scatter points for each party
            currentPartyData.forEach(data => {
                // Calculate position within the chart area
                const chartArea = chart.querySelector('.chart-grid');
                const chartWidth = chartArea.offsetWidth;
                const chartHeight = chartArea.offsetHeight;

                // Calculate percentage position within available space
                const xPercent = Math.min(data.votes / maxPercent, 1); // Cap at 100%
                const yPercent = Math.min(data.seats / maxPercent, 1); // Cap at 100%

                const x = xPercent * 100;
                const y = (1 - yPercent) * 100; // Invert Y axis

                const point = document.createElement('div');
                point.className = 'scatter-point';
                point.style.left = `calc(60px + ${x}% - 6px)`;
                point.style.top = `calc(30px + ${y}% - 6px)`;
                point.style.background = data.color;
                point.style.width = '12px';
                point.style.height = '12px';
                point.style.border = '2px solid white';
                point.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
                point.title = `${data.party}: ${data.votes}% votos, ${data.seats}% escaños`;

                chart.appendChild(point);
            });
        }

        // Generate seat map
        function generateSeatMap(composition) {
            const grid = document.getElementById('seat-grid');
            grid.innerHTML = '';
            
            // Create seats array
            const seats = [];
            Object.entries(composition).forEach(([party, count]) => {
                for (let i = 0; i < count; i++) {
                    seats.push(party.toLowerCase());
                }
            });
            
            // Shuffle seats for visual distribution
            for (let i = seats.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [seats[i], seats[j]] = [seats[j], seats[i]];
            }
            
            // Create rows (approximately 50 seats per row for 500 total)
            const seatsPerRow = 50;
            const numRows = Math.ceil(seats.length / seatsPerRow);
            
            for (let row = 0; row < numRows; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'seat-row';
                
                const startIndex = row * seatsPerRow;
                const endIndex = Math.min(startIndex + seatsPerRow, seats.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const seat = document.createElement('div');
                    seat.className = `seat ${seats[i]}`;
                    seat.title = seats[i].toUpperCase();
                    rowDiv.appendChild(seat);
                }
                
                grid.appendChild(rowDiv);
            }
        }

        // Handle control button clicks
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('segment-button') || 
                e.target.classList.contains('pill-button') || 
                e.target.classList.contains('tab-button')) {
                const group = e.target.dataset.group;
                const value = e.target.dataset.value;
                
                // Remove active class from siblings
                const siblings = e.target.parentElement.querySelectorAll('button');
                siblings.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                e.target.classList.add('active');
                
                // Update data if needed (for now, just show the action)
                console.log(`Selected ${group}: ${value}`);
                
                // You could update the seat map here based on new selections
                updateDashboard();
            }
        });

        function updateDashboard() {
            // Get current selections
            const year = document.querySelector('[data-group="year"].active')?.dataset.value || '2021';
            const model = document.querySelector('[data-group="model"].active')?.dataset.value || 'vigente';
            const chamber = document.querySelector('[data-group="chamber"].active')?.dataset.value || 'diputados';

            // Update seat map with current data
            const currentData = seatData[year]?.[model]?.[chamber];
            if (currentData) {
                generateSeatMap(currentData);
            }

            // Generate scatter plot
            generateScatterPlot();
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
        });

        // Add some interactive behavior for demonstration
        document.addEventListener('mouseover', function(e) {
            if (e.target.classList.contains('seat')) {
                e.target.style.transform = 'scale(1.3)';
                e.target.style.zIndex = '10';
            }
        });

        document.addEventListener('mouseout', function(e) {
            if (e.target.classList.contains('seat')) {
                e.target.style.transform = 'scale(1)';
                e.target.style.zIndex = '1';
            }
        });

        // Mostrar el tooltip Gallagher al lado del KPI
        document.getElementById('gallagher-info-trigger').addEventListener('click', function(e) {
            const tooltip = document.getElementById('gallagher-tooltip');
            const trigger = e.target.closest('.info-icon');
            const rect = trigger.getBoundingClientRect();
            tooltip.style.display = 'block';
            // Posicionar a la derecha del KPI
            tooltip.style.top = `${rect.top + window.scrollY - 8}px`;
            tooltip.style.left = `${rect.right + window.scrollX + 16}px`;
        });
        // Cerrar al hacer click fuera
        document.addEventListener('mousedown', function(e) {
            const tooltip = document.getElementById('gallagher-tooltip');
            const trigger = document.getElementById('gallagher-info-trigger');
            if (tooltip.style.display === 'block' && !tooltip.contains(e.target) && e.target !== trigger && !trigger.contains(e.target)) {
                tooltip.style.display = 'none';
            }
        });
    </script>
    <!-- Footer verde -->
    <footer class="footer-section"></footer>
</body>
</html>
